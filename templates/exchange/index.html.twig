{% extends 'appbase.html.twig' %}

{% block title %}Gestion des Échanges
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="{{ asset('assets/css/select2/select2.min.css') }}">

	<style>
		/* Styles existants de la page transfert réutilisés */
		.stat-card {
			border-radius: 10px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			transition: transform 0.3s ease;
		}
		.stat-card:hover {
			transform: translateY(-5px);
		}
		.stat-icon {
			font-size: 1.8rem;
			margin-bottom: 10px;
		}
		.stat-number {
			font-size: 1.5rem;
			font-weight: 700;
		}
		.stat-text {
			font-size: 0.9rem;
			color: #6c757d;
		}
		.filter-section {
			background-color: #f8f9fa;
			padding: 15px;
			border-radius: 8px;
			margin-bottom: 20px;
		}
		.filter-label {
			font-weight: 600;
			margin-bottom: 5px;
			font-size: 0.9rem;
		}
		.badge-status {
			padding: 5px 10px;
			border-radius: 20px;
			font-size: 0.8rem;
			font-weight: 600;
			text-transform: uppercase;
		}
		.badge-completed {
			background-color: #d1fae5;
			color: #065f46;
			border: 1px solid #34d399;
		}
		.badge-pending {
			background-color: #fef3c7;
			color: #92400e;
			border: 1px solid #f59e0b;
		}
		.badge-cancelled {
			background-color: #fee2e2;
			color: #991b1b;
			border: 1px solid #ef4444;
		}
		.table-exchange {
			font-size: 0.9rem;
			border-collapse: separate;
			border-spacing: 0;
			min-height: 200px;
		}
		.table-exchange thead th {
			background-color: #f8f9fa;
			position: sticky;
			top: 0;
			border-bottom: 2px solid #dee2e6;
		}
		.table-exchange tbody tr:hover {
			background-color: rgba(0, 123, 255, 0.05);
		}
	</style>
{% endblock %}

{% block main %}
	<div
		class="container-fluid">
		{# --- 1. Statistiques Échanges --- #}
		<div
			class="row mb-4" id="exchangeStats">
			<!-- Total Échanges -->
			<div class="col-md-3 mb-3">
				<div class="card stat-card border-start border-primary border-4">
					<div class="card-body">
						<div class="d-flex justify-content-between align-items-center">
							<div>
								<div class="stat-text">Total Échanges</div>
								<div class="stat-number text-primary" id="stat-total">0</div>
							</div>
							<div class="stat-icon text-primary">
								<i class="bi bi-arrow-left-right"></i>
							</div>
						</div>
						<hr class="my-2">
						<div class="d-flex justify-content-between">
							<small class="text-success">
								<i class="bi bi-check-circle"></i>
								<span id="stat-valide">0</span>
							</small>
							<small class="text-warning">
								<i class="bi bi-hourglass"></i>
								<span id="stat-attente">0</span>
							</small>
							<small class="text-danger">
								<i class="bi bi-x-circle"></i>
								<span id="stat-annule">0</span>
							</small>
						</div>
					</div>
				</div>
			</div>

			<!-- Échanges par type -->
			<div class="col-md-3 mb-3">
				<div class="card stat-card border-start border-success border-4">
					<div class="card-body">
						<div class="d-flex justify-content-between align-items-center">
							<div>
								<div class="stat-text">Échanges Achat</div>
								<div class="stat-number text-success" id="stat-achat">0</div>
							</div>
							<div class="stat-icon text-success">
								<i class="bi bi-arrow-down-circle"></i>
							</div>
						</div>
						<hr class="my-2">
						<div class="d-flex justify-content-between">
							<small class="text-primary">
								<i class="bi bi-cash-stack"></i>
								<span id="stat-montant-achat">0 FCFA</span>
							</small>
						</div>
					</div>
				</div>
			</div>

			<!-- Échanges par type -->
			<div class="col-md-3 mb-3">
				<div class="card stat-card border-start border-warning border-4">
					<div class="card-body">
						<div class="d-flex justify-content-between align-items-center">
							<div>
								<div class="stat-text">Échanges Vente</div>
								<div class="stat-number text-warning" id="stat-vente">0</div>
							</div>
							<div class="stat-icon text-warning">
								<i class="bi bi-arrow-up-circle"></i>
							</div>
						</div>
						<hr class="my-2">
						<div class="d-flex justify-content-between">
							<small class="text-primary">
								<i class="bi bi-cash-stack"></i>
								<span id="stat-montant-vente">0 FCFA</span>
							</small>
						</div>
					</div>
				</div>
			</div>

			<!-- Montants globaux -->
			<div class="col-md-3 mb-3">
				<div class="card stat-card border-start border-danger border-4">
					<div class="card-body">
						<div class="d-flex justify-content-between align-items-center">
							<div>
								<div class="stat-text">Solde Actuel</div>
								<div class="stat-number text-danger" id="stat-localsolde">0 FCFA</div>
							</div>
							<div class="stat-icon text-danger">
								<i class="bi bi-graph-up"></i>
							</div>
						</div>
						<hr class="my-2">
						<div class="d-flex justify-content-between">
							<small class="text-success">
								<i class="bi bi-currency-exchange"></i>
								<span id="stat-taux-moyen">0</span>
								taux moyen
							</small>
						</div>
					</div>
				</div>
			</div>
		</div>

		{# --- 2. Filtres --- #}
		<div class="card mb-4">
			<div class="card-header bg-light">
				<h5 class="card-title mb-0">
					<i class="bi bi-funnel-fill me-2"></i>Filtres</h5>
			</div>
			<div class="card-body">
				<div class="row g-3">
					<div class="col-md-3">
						<label class="filter-label">Période</label>
						<div class="input-group">
							<span class="input-group-text">
								<i class="bi bi-calendar"></i>
							</span>
							<input type="text" id="filterDateRange" class="form-control form-control-sm" placeholder="Sélectionner une période">
						</div>
					</div>
					<div class="col-md-2">
						<label class="filter-label">Type opération</label>
						<select id="filterType" class="form-select form-select-sm">
							<option value="">Tous types</option>
							<option value="achat">Achat</option>
							<option value="vente">Vente</option>
						</select>
					</div>
					<div class="col-md-3">
						<label class="filter-label">Agence</label>
						<select id="filterAgence" class="form-select form-select-sm">
							<option value="">Toutes agences</option>
							{# --- inserer et mise à jour automatiquement dans le js par la variable liste agences --- #}
						</select>
					</div>
				</div>
			</div>
		</div>

		{# --- 3. Liste des Échanges --- #}
		<div class="card mb-4">
			<div class="card-header bg-secondary text-white bold d-flex justify-content-between align-items-center">
				<h5 class="card-title mb-0">
					<i class="bi bi-list-ul me-2"></i>Historique des Échanges</h5>
				<div>
					<button id="refreshTable" class="btn btn-sm btn-outline-secondary text-white">
						<i class="bi bi-arrow-clockwise me-1"></i>
						Actualiser
					</button>
				</div>
			</div>
			<div class="card-body p-4">
				<div class="table-responsive">
					<table id="exchangesTable" class="table table-exchange table-hover table-stripe mb-0 w-100">
						<thead>
							<tr>
								<th width="100">Date</th>
								<th>Agence</th>
								<th>Client</th>
								<th width="100">Type</th>
								<th width="120">Total Devise</th>
								<th width="120">Total CFA</th>
								<th width="100">Actions</th>
							</tr>
						</thead>
						<tbody>
							<!-- Les données seront chargées via DataTables -->
						</tbody>
					</table>
				</div>
			</div>
		</div>

		{# --- 4. Formulaire d'Échange --- #}
		<div class="card" id="ExchangeFormCard">
			<div class="card-header bg-primary text-white">
				<h3 class="card-title mb-0">
					<i class="bi bi-currency-exchange"></i>
					Nouvel Échange
				</h3>
			</div>
			<div class="card-body">
				<form
					id="form-add-exchange" class="p-2">
					<!-- Section Client -->
					<div class="mb-3 border rounded p-2">
						<h5 class="text-primary mb-2">
							<i class="bi bi-person-fill me-1"></i>Client</h5>
						<div class="row g-2">
							<div class="col-md-6">
								<label class="form-label small fw-bold">Nom complet
									<span class="text-danger">*</span>
								</label>
								<input type="text" id="clientNom" name="clientNom" class="form-control form-control-sm" placeholder="Nom du client" required>
							</div>
							<div class="col-md-6">
								<label class="form-label small fw-bold">Téléphone
									<span class="text-danger">*</span>
								</label>
								<input type="text" id="clientPhone" name="clientPhone" class="form-control form-control-sm" placeholder="Numéro de téléphone" required>
							</div>
						</div>
					</div>

					<!-- Section Opération -->
					<div class="mb-3 border rounded p-2">
						<h5 class="text-primary mb-2">
							<i class="bi bi-gear-fill me-1"></i>Opération</h5>
						<div class="row g-2">
							<div class="col-md-4">
								<label class="form-label small fw-bold">Date
									<span class="text-danger">*</span>
								</label>
								<input type="date" id="dateOps" name="date" class="form-control form-control-sm" required>
							</div>
							<div class="col-md-4">
								<label class="form-label small fw-bold">Type
									<span class="text-danger">*</span>
								</label>
								<select id="typeOps" name="type" class="form-select form-select-sm" required>
									<option value="achat">Achat</option>
									<option value="vente">Vente</option>
								</select>
							</div>
							<div class="col-md-4">
								<label class="form-label small fw-bold">Agence
									<span class="text-danger">*</span>
								</label>
								<select id="agence" name="agence" class="form-select form-select-sm" required>
									<option value="">-- Sélectionner une agence --</option>
									{# Dynamique via JS #}
								</select>
							</div>
						</div>
					</div>

					<!-- Section Montants -->
					<div class="mb-3 border rounded p-2">
						<h5 class="text-primary mb-2">
							<i class="bi bi-cash-stack me-1"></i>Montants & Taux</h5>
						<div class="row g-2">
							<div class="col-md-4">
								<label class="form-label small fw-bold">Montant
									<span class="text-danger">*</span>
								</label>
								<div class="input-group input-group-sm">
									<span class="input-group-text">Montant :</span>
									<input type="number" id="montant" name="montant" class="form-control" placeholder="0.00" step="0.001" required>
									<span class="input-group-text" id="devise">-</span>
								</div>
							</div>
							<div class="col-md-5">
								<label class="form-label small fw-bold">Taux
									<span class="text-danger">*</span>
								</label>
								<div class="input-group input-group-sm">
									<span class="input-group-text">1</span>
									<span class="input-group-text" id="deviseAgenceDisplay">-</span>
									<span class="input-group-text">=</span>
									<input type="number" id="taux" name="taux" class="form-control" placeholder="0.00" step="0.0001" required>
									<span class="input-group-text">CFA</span>
								</div>
							</div>
							<div class="col-md-3">
								<label class="form-label small fw-bold">Total</label>
								<div class="bg-light p-2 rounded text-end">
									<span id="totalAPayer" class="fw-bold text-success">0.00 CFA</span>
								</div>
							</div>
						</div>
					</div>

					<!-- Description -->
					<div class="mb-3">
						<label class="form-label small fw-bold">Description (facultatif)</label>
						<textarea name="description" id="description" rows="2" class="form-control form-control-sm shadow-sm" placeholder="Notes ou précisions sur l’échange..."></textarea>
					</div>

					<!-- Boutons -->
					<div class="d-flex justify-content-between">
						<button type="reset" id="resetForm" class="btn btn-outline-secondary btn-sm">
							<i class="bi bi-arrow-counterclockwise me-1"></i>Réinitialiser
						</button>
						<button type="submit" class="btn btn-primary btn-sm px-3">
							<i class="bi bi-save-fill me-1"></i>Créer l'échange
						</button>
					</div>
				</form>

			</div>
		</div>
		{# --- Pour le formulaire quand c'est achat le total CFA est négatif et rouge si positif et vert  --- #}

		{# --- 5. Liste des Agences --- #}
		<div class="card mt-4">
			<div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
				<h3 class="card-title mb-0">
					<i class="bi bi-building me-2"></i>
					Agences de Change
				</h3>
				<button class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#modalAddAgence">
					<i class="bi bi-plus-circle me-1"></i>
					Ajouter
				</button>
			</div>
			<div class="card-body">
				<div class="table-responsive">
					<table id="agencesTable" class="table table-hover table-striped">
						<thead>
							<tr>
								<th>Nom</th>
								<th>Devise</th>
								<th>Localité</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{# --- 5. Généré par datatable --- #}
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<a id="btnAddExchangetFloat" href="#ExchangeFormCard" class="btn btn-lg btn-outline-primary text-bold" style="position: fixed; bottom: 80px; right: 20px; z-index: 1000;">
			<i class="bi bi-plus-lg"></i>
		</a>
	</div>

	{# --- Modals --- #}
	{# Modal Ajout Agence #}
	<div class="modal fade" id="modalAddAgence" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<form id="form-add-agence">
					<div class="modal-header">
						<h5 class="modal-title">Ajouter une Agence de Change</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<div class="row g-3">
							<div class="col-md-6">
								<label class="form-label">Nom
									<span class="text-danger">*</span>
								</label>
								<input type="text" name="nom" class="form-control" required>
							</div>
							<div class="col-md-6">
								<label class="form-label">Devise
									<span class="text-danger">*</span>
								</label>
								<select name="devise" class="form-control form-select">
									<option value="AED">AED - Dirham des Émirats Arabes Unis</option>
									<option value="EUR">EUR - Euro</option>
									<option value="USD">USD - Dollar américain</option>
									<option value="GBP">GBP - Livre sterling</option>
									<option value="CNY">CNY - Yuan chinois</option>
									<option value="MAD">MAD - Dirham marocain</option>
									<option value="DZD">DZD - Dinar algérien</option>
								</select>
							</div>
							<div class="col-md-6">
								<label class="form-label">Contact
									<span class="text-danger">*</span>
								</label>
								<input type="text" name="contact" class="form-control">
							</div>
							<div class="col-md-6">
								<label class="form-label">Localité</label>
								<input type="text" name="localite" class="form-control" required>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
						<button type="submit" class="btn btn-primary">Enregistrer</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	{# Modal Édition Agence #}
	<div class="modal fade" id="modalEditAgence" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<form id="form-edit-agence">
					<div class="modal-header">
						<h5 class="modal-title">Modifier une Agence de Change</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<div class="row g-3">
							<div class="col-md-6">
								<label class="form-label">Nom
									<span class="text-danger">*</span>
								</label>
								<input type="text" name="nom" id="edit-nom" class="form-control" required>
							</div>
							<div class="col-md-6">
								<label class="form-label">Localité
									<span class="text-danger">*</span>
								</label>
								<input type="text" name="localite" id="edit-localite" class="form-control" required>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<input type="hidden" id="edit-agence-id" name="id">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
						<button type="submit" class="btn btn-primary">Mettre à jour</button>
					</div>
				</form>
			</div>
		</div>
	</div>


	{# Modal Validation Échange #}
	<div class="modal fade" id="modalValidateExchange" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Valider l'Échange</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>Êtes-vous sûr de vouloir valider cet échange ?</p>
					<div class="alert alert-info">
						<i class="bi bi-info-circle"></i>
						Cette action est irréversible.
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
					<button type="button" class="btn btn-primary" id="confirmValidate">Confirmer</button>
				</div>
			</div>
		</div>
	</div>

	{# Modal Annulation Échange #}
	<div class="modal fade" id="modalCancelExchange" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form id="form-cancel-exchange">
					<div class="modal-header">
						<h5 class="modal-title">Annuler l'Échange</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<input type="hidden" id="cancelExchangeId" name="exchangeId">
						<div class="mb-3">
							<label class="form-label">Raison de l'annulation
								<span class="text-danger">*</span>
							</label>
							<textarea name="reason" class="form-control" rows="3"></textarea>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
						<button type="submit" class="btn btn-danger">Confirmer l'annulation</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	{# Modal Suppression Échange #}
	<div class="modal fade" id="modalDeleteExchange" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Supprimer l'Échange</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>Êtes-vous sûr de vouloir supprimer définitivement cet échange ?</p>
					<div class="alert alert-danger">
						<i class="bi bi-exclamation-triangle"></i>
						Cette action est irréversible et supprimera toutes les données associées.
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
					<button type="button" class="btn btn-danger" id="confirmDelete">Supprimer</button>
				</div>
			</div>
		</div>
	</div>


	{# Modal Désactivation Agence #}
	<div class="modal fade" id="modalDesactivateAgence" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Désactiver l'Agence</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>Êtes-vous sûr de vouloir désactiver cette agence ?</p>
					<div class="alert alert-warning">
						<i class="bi bi-exclamation-triangle"></i>
						Aucun échange ne pourra être effectué avec cette agence tant qu'elle est désactivée.
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
					<button type="button" class="btn btn-danger" id="confirmDesactivate">Désactiver</button>
				</div>
			</div>
		</div>
	</div>

	{# Modal Activation Agence #}
	<div class="modal fade" id="modalActivateAgence" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Activer l'Agence</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>Êtes-vous sûr de vouloir activer cette agence ?</p>
					<div class="alert alert-info">
						<i class="bi bi-info-circle"></i>
						Les échanges pourront à nouveau être effectués avec cette agence.
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
					<button type="button" class="btn btn-success" id="confirmActivate">Activer</button>
				</div>
			</div>
		</div>
	</div>

	{# Modal Voir Échange #}
	<div class="modal fade" id="viewExchangeModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header bg-light">
					<h5 class="modal-title">Détails de l'Échange</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="row">
						<div class="col-md-6">
							<div class="card mb-3">
								<div class="card-header bg-light">
									<h6 class="mb-0">
										<i class="bi bi-info-circle me-2"></i>Informations Générales</h6>
								</div>
								<div class="card-body">
									<div class="mb-2">
										<small class="text-muted">Date :</small>
										<div class="fw-bold" id="exchangeDate"></div>
									</div>
									<div class="mb-2">
										<small class="text-muted">Type :</small>
										<div class="fw-bold" id="exchangeType"></div>
									</div>
									<div class="mb-2">
										<small class="text-muted">Agence :</small>
										<div class="fw-bold" id="exchangeAgence"></div>
									</div>
									{# <div class="mb-2">
										<small class="text-muted">Statut :</small>
										<div id="exchangeStatus"></div>
									</div> #}
								</div>
							</div>

							<div class="card">
								<div class="card-header bg-light">
									<h6 class="mb-0">
										<i class="bi bi-person-fill me-2"></i>Client</h6>
								</div>
								<div class="card-body">
									<div class="mb-2">
										<small class="text-muted">Nom :</small>
										<div class="fw-bold" id="exchangeClientName"></div>
									</div>
									<div class="mb-2">
										<small class="text-muted">Téléphone :</small>
										<div class="fw-bold" id="exchangeClientPhone"></div>
									</div>
								</div>
							</div>
						</div>

						<div class="col-md-6">
							<div class="card h-100">
								<div class="card-header bg-light">
									<h6 class="mb-0">
										<i class="bi bi-cash-stack me-2"></i>Détails Financiers</h6>
								</div>
								<div class="card-body">
									<div class="mb-2">
										<small class="text-muted">Devise cible :</small>
										<div class="fw-bold" id="exchangeDevise"></div>
									</div>
									
									<div class="mb-2">
										<small class="text-muted">Taux appliqué :</small>
										<div class="fw-bold" id="exchangeRate"></div>
									</div>
									<hr>
                                    <div class="mb-2">
										<small class="text-muted">Total CFA :</small>
										<div class="fw-bold fs-5" id="exchangeAmount"></div>
									</div>
									<div class="mb-2">
										<small class="text-muted">Total Devise :</small>
										<div class="fw-bold fs-5 text-success" id="exchangeTotal"></div>
									</div>
                                    
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer bg-light">
					<div class="d-flex justify-content-between w-100">
						<div>
							<button id="printReceiptBtn" class="btn btn-outline-secondary me-2">
								<i class="bi bi-printer me-1"></i>
								Imprimer
							</button>
						</div>
						<div>
							<button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">
								<i class="bi bi-x-circle me-1"></i>
								Fermer
							</button>
							<div class="btn-group">
								<button id="cancelExchangeBtn" class="btn btn-danger d-none">
									<i class="bi bi-x-circle me-1"></i>
									Annuler
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="{{ asset('assets/js/select2/select2.min.js') }}"></script>
	<script src="{{ asset('assets/appjs/exchange.js') }}"></script>
{% endblock %}

{# 
    pour le js créer une variable pour les deux tables la liste des agences
    les données de la table échange sont récupérés a partir dune route api
    desactive les boutons pour tout les submit de formulaire et reactive après envoie pour éviter les doublons
    pour les retours utilise la fonction perso showToastModal({message : '', type:''})
    les agences sont rechargés par datatable sans ajax avec la variable agences.
    les agences sont automatiquement mis àjourr dans les selcet dd filtre et de formulaire
    faire la toute les validations des actions pour les modals présents
    fais une version qui fonctionnera sans back-end et mets les ajax normales en commentaire. 
  #}
