{% extends 'appbase.html.twig' %}
{% block title %}Gestion des Transferts{% endblock %}

{% block stylesheets %}
  <style>/* Utilisation des variables Bootstrap */
.form-select {
  --bs-form-select-bg: var(--bs-body-bg);
  --bs-form-select-color: var(--bs-body-color);
  --bs-form-select-border-color: var(--bs-border-color);
  --bs-form-select-hover-border-color: var(--bs-primary);
}

/* Style des capitales en gras avec variables Bootstrap */
.form-select option strong {
  font-weight: var(--bs-font-weight-bold) !important; /* Utilise la variable Bootstrap pour "bold" */
  color: var(--bs-emphasis-color) !important; /* Couleur d'accentuation (noir ou blanc selon le th√®me) */
}

/* Am√©liorations UX avec variables Bootstrap */
.form-select option:checked {
  background-color: rgba(var(--bs-primary-rgb), 0.1) !important;
}

.form-select option:hover {
  background-color: var(--bs-tertiary-bg) !important;
}</style>
{% endblock %}
{% block main %}
<div class="container-fluid">
  {# --- 1. Statistiques Transferts --- #}
  <div class="row mb-4" id="transferStats">
    <div class="row gx-2 gy-3">
    <div class="col-12 col-sm-6 col-md-4 col-lg-2">
      <div class="info-box">
        <span class="info-box-icon bg-primary"><i class="bi bi-receipt"></i></span>
        <div class="info-box-content">
          <span class="info-box-text">Total</span>
          <span class="info-box-number">--</span>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-md-4 col-lg-2">
      <div class="info-box">
        <span class="info-box-icon bg-info"><i class="bi bi-people-fill"></i></span>
        <div class="info-box-content">
          <span class="info-box-text">Intern</span>
          <span class="info-box-number">--</span>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-md-4 col-lg-2">
      <div class="info-box">
        <span class="info-box-icon bg-success"><i class="bi bi-building"></i></span>
        <div class="info-box-content">
          <span class="info-box-text">Gesta</span>
          <span class="info-box-number">--</span>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-md-4 col-lg-2">
      <div class="info-box">
        <span class="info-box-icon bg-warning"><i class="bi bi-exclamation-octagon"></i></span>
        <div class="info-box-content">
          <span class="info-box-text">Impay√©es</span>
          <span class="info-box-number">--</span>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-md-4 col-lg-2">
      <div class="info-box">
        <span class="info-box-icon bg-secondary"><i class="bi bi-clock-history"></i></span>
        <div class="info-box-content">
          <span class="info-box-text">Nouveaux</span>
          <span class="info-box-number">--</span>
        </div>
      </div>
    </div>
  </div>
  </div>
  {# --- 2. Liste des Transferts --- #}
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3 class="card-title">Historique des Transferts</h3>
    <div>
      <button id="btnExportExcel" class="btn btn-sm btn-outline-success me-2">
        <i class="bi bi-file-earmark-excel"></i> Excel
      </button>
      <button id="btnExportPDF" class="btn btn-sm btn-outline-danger">
        <i class="bi bi-file-earmark-pdf"></i> PDF
      </button>
    </div>
  </div>
  <div class="card-body">
    <div class="row g-2 mb-3">
      <div class="col-md-3">
        <input type="text" id="filterInvoiceDate" class="form-control" placeholder="P√©riode (ex. 01/01/2025 - 31/01/2025)">
      </div> 
      <div class="col-md-3">
        <select id="filterStatus" class="form-select">
          <option value="">Tous statuts</option>
          <option value="completed">Compl√©t√©</option>
          <option value="pending">En attente</option>
          <option value="failed">√âchou√©</option>
          <option value="partially_paid">Partiellement pay√©</option>
        </select>
      </div>
      <div class="col-md-3">
        <input type="text" id="filterSearch" class="form-control" placeholder="Recherche...">
      </div>
    </div>
    
    <div class="table-responsive">
      <table id="transfersTable" class="table table-bordered table-hover">
        <thead class="table-light">
          <tr>
            <th width="120">R√©f.</th>
            <th>B√©n√©ficiaire</th>
            <th width="150">Montant</th>
            <th width="150">Frais</th>
            <th width="150">Total</th>
            <th width="120">Devise</th>
            <th width="150">Date</th>
            <th width="120">Statut</th>
            <th width="100">Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Exemple de ligne -->
          <tr>
            <td>TRF-2023-001</td>
            <td>Jean Dupont (FR)</td>
            <td class="text-end">1,250.00</td>
            <td class="text-end">25.00</td>
            <td class="text-end fw-bold">1,275.00</td>
            <td>EUR</td>
            <td>15/06/2023</td>
            <td><span class="badge bg-success">Compl√©t√©</span></td>
            <td class="text-center">
              <button class="btn btn-sm btn-outline-primary" title="D√©tails">
                <i class="bi bi-eye"></i>
              </button>
            </td>
          </tr>
          <!-- Autres lignes seraient g√©n√©r√©es dynamiquement -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="card mt-4">
  <div class="card-header bg-primary text-white">
    <h3 class="card-title mb-0">Ajouter un Transfert</h3>
  </div>
  <div class="card-body">
    <form id="form-add-transfer">
      <!-- Section Op√©ration -->
      <div class="section mb-4 p-3 border rounded">
        <h4 class="text-primary mb-3"><i class="bi bi-gear-fill me-2"></i>Op√©ration</h4>
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label fw-bold">Date <span class="text-danger">*</span></label>
            <input type="date" name="date" class="form-control shadow-sm" required>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-bold">Type <span class="text-danger">*</span></label>
            <select name="type" class="form-select shadow-sm" required>
              <option value="">-- S√©lectionner --</option>
              <option value="Express">Express</option>
              <option value="Standard">Standard</option>
              <option value="Urgent">Urgent</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-bold">Destination <span class="text-danger">*</span></label>
            <select name="destination" class="form-select shadow-sm country-select" required>
              <option value="">-- S√©lectionner --</option>
              <option value="France">üá´üá∑ <strong>Paris</strong> - France</option>
              <option value="USA">üá∫üá∏ <strong>Washington D.C.</strong> - √âtats-Unis</option>
              <option value="UK">üá¨üáß <strong>Londres</strong> - Royaume-Uni</option>
              <!-- Options restantes... -->
            </select>
          </div>
        </div>
      </div>

        <!-- Section Exp√©diteur -->
      <div class="section mb-4">
        <div class="row g-3"> <!-- Utilisation de g-3 pour un espacement coh√©rent -->
          <!-- Section Exp√©diteur -->
          <div class="col-lg-6 col-md-12 mb-3 mb-lg-0"> <!-- Responsive columns -->
            <div class="p-3 border rounded h-100"> <!-- h-100 pour √©galiser la hauteur -->
              <h4 class="text-primary mb-3"><i class="bi bi-person-fill me-2"></i>Exp√©diteur</h4>
              <div class="row g-2">
                <div class="col-12">
                  <label class="form-label fw-bold">S√©lectionner l'exp√©diteur <span class="text-danger">*</span></label>
                  <select name="expediteur" class="form-select shadow-sm" required>
                    <option value="">-- Choisir un exp√©diteur --</option>
                    <option value="1">Jean Dupont</option>
                    <option value="2">Marie Martin</option>
                    <option value="3">Pierre Durand</option>
                  </select>
                </div>
                <div class="col-12 mt-2">
                  <div class="p-2 bg-light rounded">
                    <small class="text-muted">T√©l√©phone :</small>
                    <div id="expediteur-phone" class="fw-bold">-</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Section B√©n√©ficiaire -->
          <div class="col-lg-6 col-md-12">
            <div class="p-3 border rounded h-100">
              <h4 class="text-primary mb-3"><i class="bi bi-person-check-fill me-2"></i>B√©n√©ficiaire</h4>
              <div class="row g-2">
                <div class="col-12">
                  <label class="form-label fw-bold">T√©l√©phone <span class="text-danger">*</span></label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-phone"></i></span>
                    <input type="text" name="phoneBeneficiaire" class="form-control shadow-sm" placeholder="+1234567890" required>
                  </div>
                </div>
                <div class="col-12">
                  <label class="form-label fw-bold">Nom complet</label>
                  <input type="text" name="nomBeneficiaire" class="form-control shadow-sm">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Section Montants -->
      <div class="section mb-4 p-3 border rounded">
  <h4 class="text-primary mb-3"><i class="bi bi-cash-stack me-2"></i>Montants et Frais</h4>
  <div class="row g-3">
    <!-- Montant Cash -->
    <div class="col-md-4">
      <label class="form-label fw-bold">Montant Cash <span class="text-danger">*</span></label>
      <div class="input-group shadow-sm">
        <select name="deviseCash" id="deviseCash" class="form-select" style="max-width: 100px;">
          <option value="CFA">CFA</option>
          <option value="EUR">EUR</option>
          <option value="USD">USD</option>
        </select>
        <input type="number" id="montantCash" name="montantCash" class="form-control" placeholder="0.00" step="0.01" required>
      </div>
    </div>
    
    <!-- Frais d'envoi -->
    <div class="col-md-4">
      <label class="form-label fw-bold">Frais d'envoi <span class="text-danger">*</span></label>
      <input type="number" id="fraisEnvoi" name="fraisEnvoi" class="form-control shadow-sm" placeholder="0.00" step="0.01" required>
    </div>
    
    <!-- Taux de change -->
    <div class="col-md-4">
      <label class="form-label fw-bold">Taux <span class="text-danger">*</span></label>
      <div class="input-group shadow-sm">
        <span class="input-group-text">1</span>
        <span id="deviseOrigineDisplay" class="input-group-text bg-light">CFA</span>
        <span class="input-group-text">=</span>
        <input type="number" id="taux" name="taux" class="form-control" placeholder="0.00" step="0.0001" required>
        <span id="deviseCibleDisplay" class="input-group-text bg-light">USD</span>
      </div>
    </div>
    
    <!-- Montant Re√ßu (calcul√© automatiquement) -->
    <div class="col-md-4">
      <label class="form-label fw-bold">Montant Re√ßu</label>
      <div class="input-group shadow-sm">
        <span id="deviseRecueDisplay" class="input-group-text bg-light">USD</span>
        <input type="number" id="montantRecu" name="montantRecu" class="form-control" placeholder="0.00" step="0.01" readonly>
      </div>
    </div>
    
    <!-- Total √† payer -->
    <div class="col-md-8">
      <div class="p-3 bg-light rounded mt-2">
        <div class="d-flex justify-content-between">
          <span class="fw-bold">Total √† payer:</span>
          <span id="totalAPayer" class="fw-bold text-success">0.00 CFA</span>
        </div>
      </div>
    </div>
  </div>
</div>
 
      <div class="d-flex justify-content-between mt-4">
        <button type="reset" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-counterclockwise me-2"></i>R√©initialiser
        </button>
        <button type="submit" class="btn btn-primary px-4">
          <i class="bi bi-save-fill me-2"></i>Cr√©er le transfert
        </button>
      </div>
    </form>
  </div>
</div>

</div>
{# --- Modals d'Actions --- #}

{# Modal Paiement Transfert #}
<div class="modal fade" id="modalTransferPayment" tabindex="-1" aria-hidden="true" data-id='' data-remain="0">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="form-transfer-payment">
        <div class="modal-header">
          <h5 class="modal-title">Paiement du Transfert</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2 text-end">
            <h5 class="text-primary">Solde compte local : <span id="soldeCompteLocal">--</span></h5>
          </div>
          <div class="mb-1">
            <label class="form-label"><strong>Montant √† payer</strong></label>
            <input type="number" name="amount" class="form-control" id="paymentAmount" min="0" step="0.01" required>
          </div>
          <div class="mb-3">
            <label class="form-label"><strong>Mode de paiement</strong></label>
            <select name="paymentMethod" class="form-select" required>
              <option value=""> -- S√©lectionner -- </option>
              <option value="compte">Compte local</option>
              <option value="Esp√®ces">Esp√®ces</option>
              <option value="ch√®que">Ch√®que</option>
              <option value="virement">Virement</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label"><strong>R√©f√©rence (optionnel)</strong></label>
            <input type="text" name="reference" class="form-control" placeholder="R√©f√©rence du paiement">
          </div>
          <div class="mb-2 text-end">
            <small class="text-muted">Montant restant √† payer : <span id="remainingAmount">--</span> FCFA</small>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="submit" class="btn btn-primary">Valider le paiement</button>
        </div>
      </form>
    </div>
  </div>
</div>
{# Modal Annulation Transfert #}
<div class="modal fade" id="modalCancelTransfer" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="form-cancel-transfer">
        <div class="modal-header">
          <h5 class="modal-title">Annuler le Transfert</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="cancelTransferId" name="transferId">
          <div class="mb-3">
            <label>Justification (obligatoire)</label>
            <textarea name="reason" class="form-control" rows="3" required></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="submit" class="btn btn-danger">Confirmer annulation</button>
        </div>
      </form>
    </div>
  </div>
</div>
{# Modal Historique Paiements #}
<div class="modal fade" id="modalHistoryTransfer" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Historique des Paiements</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <table id="historyTable" class="table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Montant</th>
              <th>Mode</th>
              <th>R√©f√©rence</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="cachetModal" tabindex="-1" aria-labelledby="cachetModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cachetModalLabel">Imprimer le transfert</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Voulez-vous imprimer le transfert avec le cachet ?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cachetNo">Non</button>
                <button type="button" class="btn btn-primary" id="cachetYes">Oui</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block javascripts %}
  {# <script src="{{ asset('assets/appjs/transfer.js') }}"></script> #}
{% endblock %}
